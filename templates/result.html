{% extends "index.html" %} 
{% block content %}
<style>
  button {
    width: 150px;
    height: 30px;
  }

  .container {
            margin-left: 15%;
            padding: 0 20px;
            padding-bottom: 60px;
  }

  
</style>


<p style="margin-left: 15%">결과조회입니다</p>

<!--하이퍼링크 버튼-->
<div class="container">
  <button onclick="location.href = '{{ result_root }}scan/' ">
    파일 스캔
  </button>
  <button onclick="location.href = '{{ result_root }}JOINlist/SINGLE/NONE/NONE/NONE' ">
    단일 결합
  </button>
  <button onclick="location.href = '{{ result_root }}JOINlist/MULTIPLE/NONE/NONE/NONE' ">
    다중 결합
  </button>
</div>

<!--스캔 테이블 선택 화면-->
{% if  type == 'scan_select' %}
<div class="container" >SCANNED TABLES</div>

<table style = "margin-left: 15%">
  <!--테이블 각 열 설명-->
  <tr>
    <th>table name</th>
    <th>link button</th>
  </tr>

  <!--테이블 내용 채우기-->
  {% for table in table_rows %}
    <tr>
      {% for line in table %}
        <td>{{line}}</td>
        <td> <button onclick = "location.href = '{{result_root}}scan/{{line}}/'">{{ line }}</button> </td>
      {% endfor %}
    <tr>
  {% endfor %}

</table>

<!--스캔 결과 표시-->
{% elif type == 'scan_result' %}
  <!--csv파일 다운로드 버튼-->
  <div class="container">
    <button type="button" onclick="tableToCSV()">
      download CSV
  </button>
  </div>

  <!--숫자 스캔결과-->
    <table style = "margin-left: 15%" id = "csvtable">
      <caption>{{table_name}}Numeric Values</caption>
      <tr>
        <th>attribute name</th>
        <th>data type</th>
        <th>record_count</th>
        <th>distinct count</th>
        <th>null count</th>
        <th>null ratio</th>
        <th>zero count</th>
        <th>zero ratio</th>
        <th>min value</th>
        <th>max value</th>
        <th>is candidate</th>
      </tr>

      {% for row in numeric_rows%}
        <tr> 
            {% for val in row %}
              <td>{{val}}</td>
            {% endfor %}
        </tr>
      {% endfor %}
    </table>

  <!--문자 스캔결과-->
    <table style = "margin-left: 15%" id = "categorical_result">
      <caption>{{table_name}}Categorical Values</caption>
      <tr>
        <th>attribute name</th>
        <th>data type</th>
        <th>record_count</th>
        <th>distinct count</th>
        <th>null count</th>
        <th>null ratio</th>
        <th>symbol count</th>
      </tr>

      {% for rows in categoric_rows%}
        <tr> 
            {% for vals in rows %}
              <td>{{vals}}</td>
            {% endfor %}
        </tr>
      {% endfor %}
    </table>
  
{% elif type == 'SINGLE' or type == 'MULTIPLE' %}
  <!--단일결합 결과조회-->

  <!--조건선택 부분-->
  <div class ="container">
    <form name = "single_select_condition" method = "post">
      <fieldset>
        <legend>검색 조건 입력</legend>
          포함할 테이블 : <input type ="text" name = "used_table"> <br>
          최소 결합률 : <input type = "text" name = "joined_ratio_limit"> <br>
          최소 레코드 수 : <input type = "text" name = "min_record_num_limit"> <br>
      </fieldset>
    </form>
    <button onclick = 'conditiond_result()'>조건 맞게 검색</button>

    <!--현재 화면에보이는 결과 CSV로 다운로드-->
    <button onclick = 'tableToCSV()'>CSV로 다운로드</button>

    <!--결과 테이블-->
    <table>
      <!--맨 윗행(설명하는부분)-->
      <tr>
        <th>ID</th>
        {% if type == "MULTIPLE" %}
        <th>Inner ID</th>
        {% endif %}
        <th>테이블 A</th>
        <th>A 레코드수<th>
        <th>A 결합키</th>
        <th>테이블 B</th>
        <th>B 레코드수</th>
        <th>B 결합키</th>
        <th>결합테이블 이름</th>
        <th>결합키(표준이름)</th>
        <th>결합테이블 레코드수</th>
        <th>A 결합 성공률</th>
        <th>B 결합 성공률</th>
        <th>완료여부</th>
        <th>진행률</th>
        <th>결과링크</th>
      </tr>
      <!--테이블 내용 완성-->
      {% for row in joined_result %}
        <tr>
        {% for val in row %}
          <td>{{val}}</td>
        {% endfor %}
        <td> <button onclick = "location.href = {{result_root}}result/">세부링크</button> <!--결합결과로 링크 이동 (아직 이름을 잘 모름)-->
        </tr>
      {% endfor %} 
    </table>
  </div>

{% elif type == 'MULTIPLE' %}


{% endif %}

  <script type="text/javascript">
    function conditiond_result(){

    }

    function tableToCSV() {

        // Variable to store the final csv data
        var csv_data = [];

        // Get each row data
        var rows = document.getElementsByTagName('tr');
        for (var i = 0; i < rows.length; i++) {

            // Get each column data
            var cols = rows[i].querySelectorAll('td,th');

            // Stores each csv row data
            var csvrow = [];
            for (var j = 0; j < cols.length; j++) {

                // Get the text data of each cell
                // of a row and push it to csvrow
                csvrow.push(cols[j].innerHTML);
            }

            // Combine each column value with comma
            csv_data.push(csvrow.join(","));
        }

        // Combine each row data with new line character
        csv_data = csv_data.join('\n');

        // Call this function to download csv file
        downloadCSVFile(csv_data);

    }

    function downloadCSVFile(csv_data) {

        // Create CSV file object and feed
        // our csv_data into it
        CSVFile = new Blob([csv_data], {
            type: "text/csv"
        });

        // Create to temporary link to initiate
        // download process
        var temp_link = document.createElement('a');

        // Download csv file
        temp_link.download = "GfG.csv";
        var url = window.URL.createObjectURL(CSVFile);
        temp_link.href = url;

        // This link should not be displayed
        temp_link.style.display = "none";
        document.body.appendChild(temp_link);

        // Automatically click the link to
        // trigger download
        temp_link.click();
        document.body.removeChild(temp_link);
    }
</script>



{% endblock %}