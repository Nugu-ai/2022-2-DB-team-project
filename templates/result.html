{% extends "index.html" %} 
{% block content %}
<style>
  button {
    width: 150px;
    height: 30px;
  }

  .container {
            margin-left: 15%;
            padding: 0 20px;
            padding-bottom: 60px;
  }

  
</style>

<script>
  // Quick and simple export target #table_id into a csv
function download_table_as_csv(table_id, separator = ',') {
  // Select rows from table_id
  var rows = document.querySelectorAll('table#' + table_id + ' tr');
  // Construct csv
  var csv = [];
  for (var i = 0; i < rows.length; i++) {
      var row = [], cols = rows[i].querySelectorAll('td, th');
      for (var j = 0; j < cols.length; j++) {
          // Clean innertext to remove multiple spaces and jumpline (break csv)
          var data = cols[j].innerText.replace(/(\r\n|\n|\r)/gm, '').replace(/(\s\s)/gm, ' ')
          // Escape double-quote with double-double-quote (see https://stackoverflow.com/questions/17808511/properly-escape-a-double-quote-in-csv)
          data = data.replace(/"/g, '""');
          // Push escaped string
          row.push('"' + data + '"');
      }
      csv.push(row.join(separator));
  }
  var csv_string = csv.join('\n');
  // Download it
  var filename = 'export_' + table_id + '_' + new Date().toLocaleDateString() + '.csv';
  var link = document.createElement('a');
  link.style.display = 'none';
  link.setAttribute('target', '_blank');
  link.setAttribute('href', 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv_string));
  link.setAttribute('download', filename);
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
}
</script>

<p style="margin-left: 15%">결과조회입니다</p>

<!--하이퍼링크 버튼-->
<div class="container">
  <button onclick="location.href = '{{ result_root }}scan/' ">
    파일 스캔
  </button>
  <button onclick="location.href = '{{ result_root }}single/' ">
    단일 결합
  </button>
  <button onclick="location.href = '{{ result_root }}multiple/' ">
    다중 결합
  </button>
</div>

<!--스캔 테이블 선택 화면-->
{% if  type == 'scan_select' %}
<div class="container" >SCANNED TABLES</div>

<table style = "margin-left: 15%">
  <!--테이블 각 열 설명-->
  <tr>
    <th>table name</th>
    <th>link button</th>
  </tr>

  <!--테이블 내용 채우기-->
  {% for table in table_rows %}
    <tr>
      {% for line in table %}
        <td>{{line}}</td>
        <td> <button onclick = "location.href = '{{result_root}}scan/{{line}}/'">{{ line }}</button> </td>
      {% endfor %}
    <tr>
  {% endfor %}

</table>

<!--스캔 결과 표시-->
{% elif type == 'scan_result' %}
  <!--csv파일 다운로드 버튼-->
  <div class="container">
    <a href="#" onclick="download_table_as_csv('csvtable');">Download as CSV</a>
    <button href ="" id = "categorical_download">범주속성 스캔결과 csv 다운로드</button>
  </div>

  <!--숫자 스캔결과-->
    <div class="container">Numeric Values</div>
    <table style = "margin-left: 15%" id = "csvtable">
      <tr>
        <th>table name</th>
        <th>attribute name</th>
        <th>data type</th>
        <th>record_count</th>
        <th>distinct count</th>
        <th>null count</th>
        <th>null ratio</th>
        <th>zero count</th>
        <th>zero ratio</th>
        <th>min value</th>
        <th>max value</th>
        <th>is candidate</th>
      </tr>

      {% for row in numeric_rows%}
        <tr> 
            {% for val in row %}
              <td>{{val}}</td>
            {% endfor %}
        </tr>
      {% endfor %}
    </table>

  <!--문자 스캔결과-->
    <div>Categorical Values</div>
    <table style = "margin-left: 15%" id = "categorical_result">
      <tr>
        <th>table name</th>
        <th>attribute name</th>
        <th>data type</th>
        <th>record_count</th>
        <th>distinct count</th>
        <th>null count</th>
        <th>null ratio</th>
        <th>symbol count</th>
      </tr>

      {% for rows in categorical_rows%}
        <tr> 
            {% for vals in rows %}
              <td>{{vals}}</td>
            {% endfor %}
        </tr>
      {% endfor %}
    </table>
  

{% endif %}




{% endblock %}
