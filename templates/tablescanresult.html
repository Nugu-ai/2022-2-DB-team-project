{% extends "index.html"  %}
{% block content %}
    <style>
        .title {
            margin-left: 15%;
            padding: 0 20px;
        }

        .container {
            margin-left: 15%;
        }

        .result1 {
            padding: 0 20px;
            display: flex;
            flex-direction: column;
            /* justify-content: center; */
        }

        table {
            border-collapse: collapse;
            font-size: 14.5px;
            text-align: center;
            margin-bottom: 20px;
        }

        thead {
            background: #bbdefb;
        }

        th {
            border: 1px solid black;
        }

        td {
            border: 1px solid black;
        }

        button {
            width: 250px;
        }

        button:hover {
            cursor: pointer;
        }

    </style>

    <h1 class="title">{{table_name}} 속성 도메인 스캔</h1>
    <div class="container"> 
        <div class="result1">
            <h3>수치 속성 스캔 결과</h3>
            <table style="border:1px solid black">
                <thead>
                    <tr>
                        <th>속성명</th>
                        <th>데이터 타입</th>
                        <th>NULL 레코드 수</th>
                        <th>NULL 레코드 비율</th>
                        <th>상이 수치 값</th>
                        <th>최대 값</th>
                        <th>최소 값</th>
                        <th>0 레코드 수</th>
                        <th>0 레코드 비율</th>
                        <th>대표 속성</th>
                        <th>결합키 후보</th>
                        <th>대표 결합키</th>
                    </tr>
                </thead>
                <tbody class="n_tbody">
                </tbody>
            </table>
            <button>수치 속성 스캔 결과 내려받기</button>
        </div>
        <div class="result1">
            <h3>범주 속성 스캔 결과</h3>
            <table style="border:1px solid black">
                <thead>
                    <tr>
                        <th>속성명</th>
                        <th>데이터 타입</th>
                        <th>NULL 레코드 수</th>
                        <th>NULL 레코드 비율</th>
                        <th>상이 범주 값</th>
                        <th>특수문자 포함 레코드 수</th>
                        <th>특수문자 포함 레코드 비율</th>
                        <th>대표 속성</th>
                        <th>결합키 후보</th>
                        <th>대표 결합키</th>
                    </tr>
                </thead>
                <tbody class="c_tbody">
                </tbody>
            </table>
            <button>범주 속성 스캔 결과 내려받기</button>
        </div>     
    </div>


    <script>
        /* 총 레코드 수 */
        let total_record = parseInt('{{total_record}}')

        /* string -> object로 변경 */
        let attr = '{{attr}}'
        attr = attr.replace(/&#39;/g,"")
        attr = attr.replace("[","")
        attr = attr.replace("]","")
        attr = attr.replace(/(\s*)/g,"")
        attr = attr.split(',')

        let datype = '{{datype}}'
        datype = datype.replace(/&#39;/g,"")
        datype = datype.replace("[","")
        datype = datype.replace("]","")
        datype = datype.replace(/(\s*)/g,"")
        datype = datype.split(',')

        let nullcount = '{{null}}'
        nullcount= nullcount.replace("[","")
        nullcount = nullcount.replace("]","")
        nullcount = nullcount.split(',')

        let recordcount = '{{record}}'
        recordcount= recordcount.replace("[","")
        recordcount = recordcount.replace("]","")
        recordcount = recordcount.split(',')

        let dist = '{{distinct}}'
        dist = dist.replace("[","")
        dist = dist.replace("]","")
        dist = dist.split(',')

        let isnumeric = '{{isnumeric}}'
        isnumeric = isnumeric.replace(/&#39;/g,"")
        isnumeric = isnumeric.replace("[","")
        isnumeric = isnumeric.replace("]","")
        isnumeric = isnumeric.replace(/(\s*)/g,"")
        isnumeric = isnumeric.split(',')

        let iscandidate = '{{candidate}}'
        iscandidate = iscandidate.replace(/&#39;/g,"")
        iscandidate = iscandidate.replace("[","")
        iscandidate = iscandidate.replace("]","")
        iscandidate = iscandidate.replace(/(\s*)/g,"")
        iscandidate = iscandidate.split(',')
        candidate = []
        for (let i=0;i<iscandidate.length;i++) {
            if (iscandidate[i]=='T') {
                candidate.push('O')
            } else {
                candidate.push('X')
            }
        }

        let zerocount = '{{zero}}'
        zerocount = zerocount.replace("[","")
        zerocount = zerocount.replace("]","")
        zerocount = zerocount.split(',')

        let minv = '{{minv}}'
        minv = minv.replace("[","")
        minv = minv.replace("]","")
        minv = minv.split(',')

        let maxv = '{{maxv}}'
        maxv = maxv.replace("[","")
        maxv = maxv.replace("]","")
        maxv = maxv.split(',')

        let symbolcount = '{{symbol}}'
        symbolcount = symbolcount.replace("[","")
        symbolcount = symbolcount.replace("]","")
        symbolcount = symbolcount.split(',')

        /* 투플 생성 */
        const CreateTuple = (num) => {
            let numeric_tr = ""
            let categoric_tr = ""

            let numeric_count = 0;
            let categoric_count = 0;

            for (let i=0; i<num; i++) {
                if (isnumeric[i] == 'T') {
                    numeric_tr += `
                    <tr>
                        <td>`+attr[i]+`</td>
                        <td>`+datype[i]+`</td>
                        <td>`+nullcount[i]+`</td>
                        <td>`+(parseInt(nullcount[i])/parseInt(recordcount[i]))+`</td>
                        <td>`+dist[i]+`</td>
                        <td>`+minv[numeric_count]+`</td>
                        <td>`+maxv[numeric_count]+`</td>
                        <td>`+zerocount[numeric_count]+`</td>
                        <td>`+(zerocount[numeric_count]/parseInt(recordcount[i]))+`</td>
                        <td class='RA-`+i+`'></td>
                        <td>`+candidate[i]+`</td>
                        <td class='JK-`+i+`'></td>
                    </tr>
                    `
                    document.querySelector('.n_tbody').innerHTML = numeric_tr;
                    numeric_count += 1;
                }
                else if (isnumeric[i] == 'F') {
                    categoric_tr += `
                    <tr>
                        <td>`+attr[i]+`</td>
                        <td>`+datype[i]+`</td>
                        <td>`+nullcount[i]+`</td>
                        <td>`+(parseInt(nullcount[i])/parseInt(recordcount[i]))+`</td>
                        <td>`+dist[i]+`</td>
                        <td>`+symbolcount[categoric_count]+`</td>
                        <td>`+(symbolcount[categoric_count]/parseInt(recordcount[i]))+`</td>
                        <td class='RA-`+i+`'></td>
                        <td>`+candidate[i]+`</td>
                        <td class='JK-`+i+`'></td>
                    </tr>
                    `
                    document.querySelector('.c_tbody').innerHTML = categoric_tr;
                    categoric_count += 1;
                }
            }   
        };

        CreateTuple(total_record)



        /* 대표속성 */
        let attr_name_RA = '{{attr_name_RA}}'
        attr_name_RA = attr_name_RA.replace(/&#39;/g,"")
        attr_name_RA = attr_name_RA.replace("[","")
        attr_name_RA = attr_name_RA.replace("]","")
        attr_name_RA = attr_name_RA.replace(/(\s*)/g,"")
        attr_name_RA = attr_name_RA.split(',')

        let repr_attr = '{{repr_attr}}'
        repr_attr = repr_attr.replace(/&#39;/g,"")
        repr_attr = repr_attr.replace("[","")
        repr_attr = repr_attr.replace("]","")
        repr_attr = repr_attr.replace(/(\s*)/g,"")
        repr_attr = repr_attr.split(',')
        
        for (let i=0; i<total_record;i++) {
            if (attr_name_RA.includes(attr[i])) {
                /* 대표속성 있는 속성 */
                let n = attr_name_RA.indexOf(attr[i])
                document.querySelector('.RA-'+i).innerHTML = repr_attr[n]
            } else {
                /* 대표속성 없는 속성 */
                document.querySelector('.RA-'+i).innerHTML = '-'
            }
        }


        /* 대표결합키 */
        let attr_name_JK = '{{attr_name_JK}}'
        attr_name_JK = attr_name_JK.replace(/&#39;/g,"")
        attr_name_JK = attr_name_JK.replace("[","")
        attr_name_JK = attr_name_JK.replace("]","")
        attr_name_JK = attr_name_JK.replace(/(\s*)/g,"")
        attr_name_JK = attr_name_JK.split(',')
        console.log(attr_name_JK)

        let join_key = '{{join_key}}'
        join_key = join_key.replace(/&#39;/g,"")
        join_key = join_key.replace("[","")
        join_key = join_key.replace("]","")
        join_key = join_key.replace(/(\s*)/g,"")
        join_key = join_key.split(',')
        console.log(join_key)
        
        for (let i=0; i<total_record;i++) {
            if (attr_name_JK.includes(attr[i])) {
                /* 대표결합키 있는 속성 */
                let n = attr_name_JK.indexOf(attr[i])
                document.querySelector('.JK-'+i).innerHTML = join_key[n]
            } else {
                /* 대표결합키 없는 속성 */
                document.querySelector('.JK-'+i).innerHTML = '-'
            }
        }
        
    </script>

{% endblock %}